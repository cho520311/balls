<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°ç«¹é­šä¸¸æ¡è³¼åœ˜</title>
    <style>
        :root { --primary-color: #2e59a7; --bg-color: #f4f7f6; }
        body { font-family: "PingFang TC", "Heiti TC", "Microsoft JhengHei", sans-serif; background-color: var(--bg-color); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 500px; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--primary-color); margin-bottom: 25px; }
        
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #444; }
        input[type="text"] { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        
        .item-list { margin-bottom: 25px; }
        .item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee; }
        .item-info { flex: 1; }
        .item-name { font-weight: 500; display: block; }
        .item-price { font-size: 0.9em; color: #666; }
        
        select { padding: 8px 12px; border-radius: 6px; border: 1px solid #ccc; font-size: 16px; background: #fff; cursor: pointer; }
        
        .total-display { text-align: right; font-size: 20px; font-weight: bold; color: #d9534f; margin: 20px 0; padding-top: 10px; border-top: 2px solid #eee; }
        .btn { width: 100%; padding: 15px; background: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn:hover { background: #1e3c72; transform: translateY(-1px); }
        .btn:disabled { background: #ccc; cursor: not-allowed; }

        /* å³æ™‚çœ‹æ¿ */
        .live-board { width: 100%; max-width: 500px; margin-top: 30px; background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        h3 { border-left: 5px solid var(--primary-color); padding-left: 10px; color: #333; margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th, td { padding: 12px 8px; text-align: left; border-bottom: 1px solid #f0f0f0; }
        th { background: #f8f9fa; color: var(--primary-color); }
        .order-detail { color: #666; font-size: 13px; }
        .loading-text { text-align: center; color: #999; padding: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸš æ–°ç«¹é­šä¸¸æ¡è³¼ç™»è¨˜</h2>
    
    <div class="input-group">
        <label for="name">è¨‚è³¼äººå§“å</label>
        <input type="text" id="name" placeholder="è«‹è¼¸å…¥æ‚¨çš„çœŸå¯¦å§“å" required>
    </div>

    <div class="item-list">
        <div class="item"><div class="item-info"><span class="item-name">åŒ…é¤¡é­šä¸¸</span><span class="item-price">170å…ƒ/æ–¤</span></div><select class="qty" data-name="åŒ…é¤¡é­šä¸¸" data-price="170"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></div>
        <div class="item"><div class="item-info"><span class="item-name">ç„¡åŒ…é¤¡é­šä¸¸</span><span class="item-price">150å…ƒ/æ–¤</span></div><select class="qty" data-name="ç„¡åŒ…é¤¡é­šä¸¸" data-price="150"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></div>
        <div class="item"><div class="item-info"><span class="item-name">åŸå‘³è²¢ä¸¸</span><span class="item-price">190å…ƒ/æ–¤</span></div><select class="qty" data-name="åŸå‘³è²¢ä¸¸" data-price="190"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></div>
        <div class="item"><div class="item-info"><span class="item-name">é¦™è‡è²¢ä¸¸</span><span class="item-price">190å…ƒ/æ–¤</span></div><select class="qty" data-name="é¦™è‡è²¢ä¸¸" data-price="190"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></div>
        <div class="item"><div class="item-info"><span class="item-name">ç¦å·ç‡•ä¸¸</span><span class="item-price">220å…ƒ/æ–¤</span></div><select class="qty" data-name="ç¦å·ç‡•ä¸¸" data-price="220"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></div>
        <div class="item"><div class="item-info"><span class="item-name">é®®è”¥è²¢ä¸¸</span><span class="item-price">220å…ƒ/æ–¤</span></div><select class="qty" data-name="é®®è”¥è²¢ä¸¸" data-price="220"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></div>
    </div>

    <div class="total-display">ç¸½é‡‘é¡ï¼šNT$ <span id="totalPrice">0</span></div>
    
    <button class="btn" id="submitBtn" onclick="sendOrder()">ç¢ºèªé€å‡ºè¨‚å–®</button>
</div>

<div class="live-board">
    <h3>ğŸ“Š ç›®å‰è¨‚è³¼æƒ…å½¢</h3>
    <table>
        <thead>
            <tr><th>å§“å</th><th>æ˜ç´°</th><th>é‡‘é¡</th></tr>
        </thead>
        <tbody id="orderList">
            <tr><td colspan="3" class="loading-text">è®€å–ä¸­...</td></tr>
        </tbody>
    </table>
</div>

<script>
    const gasUrl = 'https://script.google.com/macros/s/AKfycbxeDlKGE62S1RMcfkmKTfJn4pRTsXz_-zFMV7pDAzJtzjJCMyz2xCJXW2xn34JQmDM0jQ/exec'; // ğŸ‘ˆ é€™è£¡æ›æˆæ–°çš„ GAS ç¶²å€

    // è‡ªå‹•è¨ˆç®—ç¸½é‡‘é¡
    document.querySelectorAll('.qty').forEach(select => {
        select.addEventListener('change', () => {
            let total = 0;
            document.querySelectorAll('.qty').forEach(s => {
                total += s.value * s.dataset.price;
            });
            document.getElementById('totalPrice').innerText = total;
        });
    });

    // é é¢è¼‰å…¥æ™‚å–å¾—è³‡æ–™
    window.onload = fetchOrders;

    async function fetchOrders() {
        try {
            const response = await fetch(gasUrl);
            const data = await response.json();
            const listBody = document.getElementById('orderList');
            listBody.innerHTML = '';
            
            if (data.length === 0) {
                listBody.innerHTML = '<tr><td colspan="3" class="loading-text">ç›®å‰å°šç„¡äººè¨‚è³¼</td></tr>';
                return;
            }

            data.reverse().forEach(row => { // è®“æœ€æ–°çš„è¨‚å–®æ’åœ¨æœ€ä¸Šé¢
                const tr = document.createElement('tr');
                tr.innerHTML = `<td><b>${row[0]}</b></td><td class="order-detail">${row[1]}</td><td>$${row[2]}</td>`;
                listBody.appendChild(tr);
            });
        } catch (e) {
            console.error(e);
        }
    }

    async function sendOrder() {
        const name = document.getElementById('name').value.trim();
        if (!name) return alert("è«‹è¼¸å…¥å§“å");
        
        let details = [];
        let total = 0;
        document.querySelectorAll('.qty').forEach(s => {
            if (s.value > 0) {
                details.push(s.dataset.name + 'x' + s.value);
                total += (s.value * s.dataset.price);
            }
        });

        if (total === 0) return alert("è«‹è‡³å°‘é¸æ“‡ä¸€å€‹å“é …");

        const btn = document.getElementById('submitBtn');
        btn.disabled = true;
        btn.innerText = "å‚³é€ä¸­...";

        try {
            // ä½¿ç”¨ no-cors æ¨¡å¼å‚³é€åˆ° GAS
            await fetch(gasUrl, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({ name: name, orderString: details.join
